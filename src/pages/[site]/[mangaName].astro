---
import Layout from "../../layouts/Layout.astro";
import ChapterRow from "../../components/ChapterRow.astro";
import type { MangaInfo } from "../../models/MangaInfo";
import { ImageRequest } from "../../components/ImageRequest";

const { site, mangaName } = Astro.params;

import mangaResponse from "../../../public/test-data/manga-test-data.json";

const mangaInfo: MangaInfo = mangaResponse;
const description = `Lee ${mangaInfo.name} gratis y sin anuncios en Mangateca`;

if(!mangaInfo){
  return Astro.redirect("../404");
}
---

<Layout title="Manga" description={description}>
  <div class="items-start w-11/12 lg:mt-8 lg:-mx-6 lg:flex">
    <!-- Manga Information -->
    <div
      class="hero bg-base-200 rounded-xl top-8 lg:min-w-fit lg:max-w-md lg:sticky"
    >
      <div class="hero-content flex-col">
        <ImageRequest
          imageLink={mangaInfo.cover}
          imagePlaceholder="/images/placeholders/placeholder-cover.webp"
          alt={mangaInfo.name}
          site={site}
          className="max-w-sm rounded-2xl shadow-xl h-96"
          client:idle
        />
        <div class="flex flex-col items-center">
          <h1 class="text-3xl font-bold justify-center">{mangaInfo.name}</h1>
          <p class="text-xl pb-6">{mangaInfo.chaptersNumber} capítulos</p>
          <button class="btn btn-primary">Empezar a leer</button>
        </div>
      </div>
    </div>

    <div class="divider divider-vertical lg:divider-horizontal"></div>

    <!-- Manga chapters -->
    <div class="lg:w-full max-lg:mt-0 mx-auto overflow-y-auto">
      <table class="table table-auto w-full">
        <thead>
          <tr>
            <th class="max-w-fit">Nº</th>
            <th>Nombre</th>
            <th>Sitio original</th>
          </tr>
        </thead>
        <tbody>
          {
            mangaInfo.chaptersListed.map((chapter) => (
              <ChapterRow
                chapterNumber={chapter.number}
                chapterName={"Capítulo " + chapter.number}
                link={`/${site}/${mangaName}/${chapter.number}`}
                originalLink={chapter.linkOriginal}
              />
            ))
          }
        </tbody>
      </table>
    </div>
  </div>
</Layout>
